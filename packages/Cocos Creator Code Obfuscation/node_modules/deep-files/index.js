const fs = require('fs')
const path = require('path')
const minimatch = require('minimatch')

function processDir(file, pattern) {
  let result = []
  if (fs.lstatSync(file).isDirectory()) {
    fs.readdirSync(file).forEach(_file => {
      const current = processDir(path.join(file, _file), pattern)
      result.push(...current)
    })
  }
  if (fs.lstatSync(file).isFile()) {
    if (!pattern || minimatch(file, pattern, { matchBase: true })) {
      result.push(path.resolve(file))
    }
  }
  return result
}

module.exports = processDir
